## Chapter2

### 一、CPU 多级缓存-缓存一致性

#### 什么是 CPU 缓存

CPU 是计算机的大脑，负责执行程序的指令，而内存负责存储数据。在很多年以前，CPU 的频率与内存总线的频率在同一层面上，内存访问速度仅仅比寄存器慢一些。但是，到了上世纪 90 年代，CPU 频率大大提升，导致 CPU 的运算速度比内存读写速度快很多，这样会使 CPU 花费很长的时间等待数据的到来。**为了解决 CPU 运算速度与内存读写速度不匹配的问题，CPU 缓存应运而生。**

CPU 缓存是位于 CPU 与内存之间的临时数据交换器，它的容量比内存小的多，但交换速度却比内存要快。

CPU 缓存一般直接跟 CPU 芯片集成或位于主板总线（Bus）互连的独立芯片上。

![image-20220202105028934](https://tva1.sinaimg.cn/large/008i3skNly1gyyz6otmn4j312w0rsgm9.jpg)

 #### CPU 多级缓存

随着多核 CPU 的发展，CPU 缓存通常分成了三个级别：L1，L2，L3。级别越小越接近 CPU，这意味着速度更快，同时也代表着容量越小。

L1 是最接近 CPU 的，它的容量最小，L1 缓存可以分为用于存数据的 L1d Cache（Data Cache）以及用于存指令的 L1i Cache（Instruction Cache）。L2 缓存则更大一些； L3 缓存是三级缓存中最大的一级，同时也是最慢的一级。

![image-20220202110837058](https://tva1.sinaimg.cn/large/008i3skNly1gyyzpj6bnrj312w0rs0tu.jpg)

#### CPU 多级缓存-缓存一致性（MESI）

我们知道，多核处理器中，每个核都带有多级缓存。那么假设多个核访问同一个变量时，我们就需要这些核访问的缓存中的数据是一致的，同步的。为了保证缓存内部数据的一致性，就引出了缓存一致性协议（MESI）。

缓存存储数据的单元是**缓存行（Cache Line）**。MESI 代表缓存行的四种状态，分别是：

- M（Modified）
- E（Exclusive）
- S（Shared）
- I（Invalid）



### 二、CPU 多级缓存-乱序执行优化

### 三、Java 内存模型

### 四、并发的优势与风险